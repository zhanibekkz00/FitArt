# Админ-панель - Документация

## Обзор

Админ-панель предоставляет администраторам полный контроль над приложением фитнес-трекинга для студентов.

## Функционал администратора

### 1. **Управление пользователями**
- Просмотр всех пользователей с пагинацией
- Детальная информация о каждом пользователе
- Изменение ролей (STUDENT ↔ ADMIN)
- Удаление пользователей
- Статистика активности пользователей

### 2. **Статистика и аналитика**
- **Общая статистика пользователей:**
  - Общее количество пользователей
  - Активные пользователи сегодня
  - Активные пользователи за неделю
  - Новые пользователи за месяц
  - Среднее количество тренировок на пользователя

- **Статистика тренировок:**
  - Популярные тренировки
  - Количество завершений
  - Рейтинг по уровням сложности

### 3. **Управление уведомлениями**
- Отправка массовых уведомлений всем пользователям
- Типы уведомлений:
  - **SYSTEM** - Системные объявления и обновления
  - **MOTIVATION** - Мотивационные сообщения
  - **REMINDER** - Напоминания об активностях

## Backend API

### Эндпоинты

Все эндпоинты защищены и требуют роль `ADMIN`.

#### Управление пользователями

```
GET /api/admin/users?page=0&size=20
```
Получить список всех пользователей с пагинацией.

```
GET /api/admin/users/{userId}
```
Получить детальную информацию о пользователе.

```
PUT /api/admin/users/{userId}/role?role=ADMIN
```
Изменить роль пользователя.

```
DELETE /api/admin/users/{userId}
```
Удалить пользователя.

#### Статистика

```
GET /api/admin/statistics/users
```
Получить статистику по пользователям.

**Ответ:**
```json
{
  "totalUsers": 150,
  "activeUsersToday": 45,
  "activeUsersThisWeek": 98,
  "newUsersThisMonth": 23,
  "averageWorkoutsPerUser": 12.5
}
```

```
GET /api/admin/statistics/workouts
```
Получить статистику по тренировкам.

**Ответ:**
```json
[
  {
    "workoutId": 1,
    "title": "Morning Stretch",
    "level": "BEGINNER",
    "completionCount": 234,
    "averageRating": 4.5
  }
]
```

#### Уведомления

```
POST /api/admin/notifications/broadcast
```
Отправить уведомление всем пользователям.

**Тело запроса:**
```json
{
  "message": "Важное объявление для всех пользователей!",
  "type": "SYSTEM"
}
```

## Frontend (Flutter)

### Структура файлов

```
lib/features/admin/
├── admin_panel_screen.dart          # Главный экран с табами
├── admin_statistics_tab.dart        # Вкладка статистики
├── admin_users_tab.dart             # Вкладка управления пользователями
└── admin_notifications_tab.dart     # Вкладка уведомлений
```

### Навигация

Админ-панель доступна по маршруту `/admin` и защищена проверкой роли.

```dart
// В router.dart
GoRoute(
  path: '/admin',
  redirect: (ctx, st) {
    final ref = ProviderScope.containerOf(ctx);
    return roleGuard(ref, 'admin');
  },
  builder: (ctx, st) => const AdminPanelScreen(),
),
```

### Доступ к админ-панели

1. Войдите в систему с учетной записью администратора
2. Перейдите по URL `/admin` или добавьте кнопку в навигацию
3. Используйте нижнюю навигацию для переключения между вкладками

## Учетные данные по умолчанию

При первом запуске приложения автоматически создается администратор:

- **Email:** admin@fitstudent.com
- **Пароль:** admin123
- **Роль:** ADMIN

## Безопасность

### Backend
- Все эндпоинты защищены аннотацией `@PreAuthorize("hasRole('ADMIN')")`
- JWT токены проверяются через `JwtAuthenticationFilter`
- Method security включена через `@EnableMethodSecurity`

### Frontend
- Маршруты защищены функцией `roleGuard`
- Проверка роли на уровне роутера
- Автоматическое перенаправление неавторизованных пользователей

## Расширение функционала

### Добавление новых статистик

1. Добавьте метод в `AdminService.java`
2. Создайте соответствующий DTO
3. Добавьте эндпоинт в `AdminController.java`
4. Обновите UI во Flutter

### Добавление новых действий над пользователями

1. Добавьте метод в `AdminService.java`
2. Добавьте эндпоинт в `AdminController.java`
3. Добавьте UI элемент в `admin_users_tab.dart`

## Примеры использования

### Изменение роли пользователя

```dart
await ApiService.put('/admin/users/123/role?role=ADMIN', {});
```

### Отправка уведомления

```dart
await ApiService.post('/admin/notifications/broadcast', {
  'message': 'Не забудьте выполнить тренировку сегодня!',
  'type': 'REMINDER',
});
```

### Получение статистики

```dart
final stats = await ApiService.get('/admin/statistics/users');
print('Total users: ${stats['totalUsers']}');
```

## Troubleshooting

### Ошибка 403 Forbidden
- Убедитесь, что пользователь имеет роль ADMIN
- Проверьте, что JWT токен действителен
- Проверьте настройки SecurityConfig

### Данные не загружаются
- Проверьте подключение к backend
- Убедитесь, что база данных содержит данные
- Проверьте логи backend на наличие ошибок

## Будущие улучшения

- [ ] Экспорт статистики в CSV/Excel
- [ ] Графики и диаграммы для визуализации данных
- [ ] Фильтрация и поиск пользователей
- [ ] История изменений пользователей
- [ ] Планирование отложенных уведомлений
- [ ] Управление контентом тренировок
- [ ] Модерация пользовательского контента
